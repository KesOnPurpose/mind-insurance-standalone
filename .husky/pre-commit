#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ”’ Running pre-commit security checks..."

# Run security audit (only HIGH/CRITICAL)
echo "ğŸ“¦ Checking npm dependencies..."
npm run security:check

# Run TypeScript strict check
echo "ğŸ“ Checking TypeScript..."
npx tsc --noEmit

# Run ESLint
echo "ğŸ§¹ Running ESLint..."
npm run lint

# Run Gitleaks if installed
if command -v gitleaks &> /dev/null; then
  echo "ğŸ” Scanning for secrets..."
  gitleaks detect --config .gitleaksrc.toml --no-git
else
  echo "âš ï¸  Gitleaks not installed. Install with: brew install gitleaks"
fi

echo "âœ… Pre-commit checks passed!"
