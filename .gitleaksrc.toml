# Gitleaks Configuration for Mind Insurance Grouphome App
# Detects secrets and credentials in code to prevent accidental commits

title = "Mind Insurance Security Scan"

[allowlist]
description = "Allowlist for false positives and example files"
paths = [
  '''\.env\.example$''',
  '''\.env\.template$''',
  '''README\.md$''',
  '''SECURITY-CHECKLIST\.md$''',
]

# Generic API Key Detection
[[rules]]
id = "generic-api-key"
description = "Generic API Key"
regex = '''(?i)(api[_-]?key|apikey|api[_-]?token)['"\s]*[:=]\s*['"]?[A-Za-z0-9\-_]{20,}'''
tags = ["key", "API"]

# Anthropic API Key Detection
[[rules]]
id = "anthropic-api-key"
description = "Anthropic API Key"
regex = '''sk-ant-api[0-9]{2}-[A-Za-z0-9\-_]{93,}'''
tags = ["key", "Anthropic", "CRITICAL"]

# Supabase Service Role Key (JWT format)
[[rules]]
id = "supabase-service-key"
description = "Supabase Service Role Key (JWT)"
regex = '''eyJ[A-Za-z0-9\-_=]+\.eyJ[A-Za-z0-9\-_=]+\.[A-Za-z0-9\-_.+/=]{43,}'''
tags = ["key", "Supabase", "JWT", "CRITICAL"]

# Generic Secret Detection
[[rules]]
id = "generic-secret"
description = "Generic Secret"
regex = '''(?i)(secret|password|passwd|pwd)['"\s]*[:=]\s*['"][^"'\s]{8,}['"]'''
tags = ["secret", "password"]

# AWS Access Key
[[rules]]
id = "aws-access-key"
description = "AWS Access Key ID"
regex = '''AKIA[0-9A-Z]{16}'''
tags = ["key", "AWS"]

# AWS Secret Key
[[rules]]
id = "aws-secret-key"
description = "AWS Secret Access Key"
regex = '''(?i)aws[_\s]*secret[_\s]*access[_\s]*key['"\s]*[:=]\s*['"][A-Za-z0-9/+=]{40}['"]'''
tags = ["key", "AWS"]

# Private SSH Key
[[rules]]
id = "private-ssh-key"
description = "Private SSH Key"
regex = '''-----BEGIN (RSA|DSA|EC|OPENSSH) PRIVATE KEY-----'''
tags = ["key", "SSH", "CRITICAL"]

# GitHub Personal Access Token
[[rules]]
id = "github-pat"
description = "GitHub Personal Access Token"
regex = '''ghp_[0-9a-zA-Z]{36}'''
tags = ["key", "GitHub"]

# GoHighLevel API Key
[[rules]]
id = "ghl-api-key"
description = "GoHighLevel API Key"
regex = '''(?i)(ghl[_-]?api[_-]?key|vite_ghl_api_key)['"\s]*[:=]\s*['"][A-Za-z0-9\-_]{20,}['"]'''
tags = ["key", "GoHighLevel"]

# OpenAI API Key
[[rules]]
id = "openai-api-key"
description = "OpenAI API Key"
regex = '''sk-[A-Za-z0-9]{48}'''
tags = ["key", "OpenAI"]

# Generic Bearer Token
[[rules]]
id = "bearer-token"
description = "Bearer Token in Authorization Header"
regex = '''(?i)authorization['"\s]*[:=]\s*['"]bearer\s+[A-Za-z0-9\-._~+/]+=*['"]'''
tags = ["token", "bearer"]

# Database Connection String
[[rules]]
id = "database-connection-string"
description = "Database Connection String with Credentials"
regex = '''(?i)(postgres|mysql|mongodb):\/\/[^\s:]+:[^\s@]+@[^\s\/]+'''
tags = ["database", "credentials", "CRITICAL"]

# Stripe API Key
[[rules]]
id = "stripe-api-key"
description = "Stripe API Key"
regex = '''sk_live_[0-9a-zA-Z]{24,}'''
tags = ["key", "Stripe", "payment"]

# JWT Token (high entropy)
[[rules]]
id = "jwt-token"
description = "JWT Token (Base64 encoded)"
regex = '''eyJ[A-Za-z0-9_-]*\.eyJ[A-Za-z0-9_-]*\.[A-Za-z0-9_-]*'''
tags = ["token", "JWT"]
[rules.allowlist]
  description = "Allow JWT in CLAUDE.md documentation and test files"
  paths = [
    '''CLAUDE\.md$''',
    '''TestSSE\.tsx$''',
  ]

# Email addresses (lower priority)
[[rules]]
id = "email-address"
description = "Email Address"
regex = '''[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'''
tags = ["email", "PII"]
[rules.allowlist]
  description = "Allow email addresses in documentation and legitimate code"
  paths = [
    '''README\.md$''',
    '''\.github/''',
    '''docs/''',
  ]

# IP Address (lower priority)
[[rules]]
id = "ip-address"
description = "IP Address"
regex = '''\b(?:[0-9]{1,3}\.){3}[0-9]{1,3}\b'''
tags = ["ip", "network"]
[rules.allowlist]
  description = "Allow IP addresses in config and docs"
  paths = [
    '''\.md$''',
    '''config/''',
  ]
